ADR-001: Normalize weight as string
Дата: 2025-10-16
Статус: Proposed

Context
В текущей модели Set.weight_kg хранится как Optional[float]. Использование float для пользовательских вводов веса может приводить к неоднозначностям представления (например, 20.0 vs 20, локали, потеря точности при сериализации/десериализации) и усложняет хранение обозначений типа “кг”, “lbs” или “субъективное” значение.

Decision
Изменить тип поля weight_kg в модели Set с Optional[float] на Optional[str]. Формат ожидаемой строки: десятичная запись с точкой или локально-нейтральная строка, опционально с единицей (например: "20", "20.5", "20 kg", "44 lbs"). На уровне API сохраняем строку без дальнейшего нормирования.

Alternatives
1) Преобразовывать ввод в Decimal и хранить Decimal. Плюсы: точность, семантика числа. Минусы: требует изменения сериализации/десериализации, возможные дополнительные зависимости/обработка в базе.
2) Хранить отдельные поля {value: Decimal, unit: str}. Плюсы: явная семантика единиц. Минусы: более крупный рефакторинг, изменение контрактов клиентов.
3) Оставить float и добавлять нормализацию/валидаторы при вводе. Плюсы: мало изменений. Минусы: сохраняются проблемы с представлением и локализацией.

Consequences
Плюсы: простой и безопасный контракт (строка) уменьшает риск некорректной сериализации/локализации; лёгкая совместимость с клиентами, которые отправляют "20 kg" и т.д. Минусы: потеря строгой числовой валидации на уровне схемы. Security impact: уменьшение риска аварий при десериализации произвольных float-значений; никаких новых чувствительных данных.

Rollout plan / DoD
Изменить models/Set.py, добавить тест.
