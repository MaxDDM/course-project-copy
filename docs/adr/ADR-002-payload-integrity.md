ADR-002: Enforce payload.workout_id matches URL workout_id (payload integrity)
Дата: 2025-10-16
Статус: Accepted

Context
Set должен привязываться к существующей тренировке и payload.workout_id должен совпадать с URL.

Decision
Зафиксировать поведение: в endpoint POST /workouts/{workout_id}/sets всегда валидируем, что payload.workout_id == workout_id.

Alternatives
1) Автоматически заменять payload.workout_id на значение из URL. Плюсы: удобство для клиентов. Минусы: скрытое поведение, может маскировать ошибки клиентов и нарушать принцип явности.
2) Игнорировать payload.workout_id и использовать только URL workout_id. Плюсы: простота. Минусы: меняет контракт и может сломать клиентов, которые рассчитывали на echo.
3) Оставить текущую валидацию и дополнить стандартной RFC7807 ошибкой. Плюсы: согласуется с NFR-06. Минусы: требует дополнительного кода для генерации RFC7807.

Consequences
Плюсы: явный контракт повышает целостность данных и упрощает отладку. Минусы: клиенты, которые присылают несовпадающие значения, получат ошибку. Security impact: снижает риск некорректной связки данных и несанкционированной привязки наборов к чужим тренировкам.

Rollout plan / DoD
Оставляем существующую проверку, добавляем тесты контрактов и негативные кейсы.

Links
- NFR-04
- R3
