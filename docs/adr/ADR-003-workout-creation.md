ADR-003: Improve speed of workout creation for high-throughput scenarios
Дата: 2025-10-16
Статус: Proposed

Context
Текущая реализация append в список подходит для простого приложения, но не масштабируется для сценариев с большим количеством записей или конкурентных обращений (в памяти списки и поиск any(w.id == payload.id) — O(n) для проверки существования).

Decision
Заменить список workouts_db на dict[int, Workout] для O(1) вставки и проверки существования. Это изменение минимально инвазивно (требует изменения типов в main.py и небольшого изменения в тестах) и улучшит p95 при высокой нагрузке.

Alternatives
1) Оставить список и добавить индекс (set of ids) для проверок. Плюсы: простая правка. Минусы: дублирование структуры, сложность поддержания согласованности.
2) Переехать на внешнее хранилище (SQLite/Postgres). Плюсы: масштабируемость долговременная. Минусы: гораздо больший рефакторинг и операции развертывания.
3) Использовать in-memory LRU cache или Redis. Плюсы: производительность; Минусы: инфраструктурная сложность.

Consequences
Плюсы: O(1) проверка уникальности id и вставки, улучшение p95 при увеличении числа тренировок. Минусы: изменение структуры данных в кодовой базе и возможные изменения порядка возвращаемых элементов (но порядок обычно не гарантируется).

Rollout plan / DoD
Внести изменения в main.py: заменить тип workouts_db с list на dict, изменить endpoints соответственно; обновить тесты.

Links
-NFR-01, NFR-08
-R6
